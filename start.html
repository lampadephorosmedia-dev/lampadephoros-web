<!-- FILE: start.html --> 
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lampadēphóros – Start</title>
  <meta name="description" content="Lampadēphóros – Der Fackelträger. Multilinguale Startseite." />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main class="wrap">

    <header class="hero">
      <!-- Sprache (automatisch) -->
      <div class="lang" aria-label="Sprachauswahl" data-current="de"></div>

      <!-- Brand -->
      <div class="brand">
        <img class="logo" src="logo.png" alt="Lampadēphóros Logo" />
        <div class="brand-meta">
          <div class="badge">Lampadēphóros</div>
          <div class="mini">Der Fackelträger</div>
        </div>
      </div>

      <h1 id="heroTitle">Lampadēphóros</h1>
      <p class="sub" id="heroSub"></p>

      <nav class="nav" aria-label="Navigation">
        <a class="btn primary" id="navStart" href="start.html?lang=de"></a>
        <a class="btn" id="navAbout" href="about.html"></a>
        <a class="btn" id="navFilms" href="filme.html"></a>
        <a class="btn" id="navImpulses" href="impulse.html"></a>
        <a class="btn" id="navWorkshop" href="werkstatt.html"></a>
        <a class="btn" id="navOffers" href="angebote.html"></a>
        <a class="btn" id="navShop" href="shop.html"></a>
        <a class="btn" id="navLinks" href="links.html"></a>
      </nav>

      <div class="note" id="noteLine"></div>
    </header>

    <section class="grid" aria-label="Übersicht">
      <article class="card">
        <h2 id="cAboutH"></h2>
        <p id="cAboutP"></p>
        <a id="cAboutA" href="about.html"></a>
      </article>

      <article class="card">
        <h2 id="cFilmsH"></h2>
        <p id="cFilmsP"></p>
        <a id="cFilmsA" href="filme.html"></a>
      </article>

      <article class="card">
        <h2 id="cImpH"></h2>
        <p id="cImpP"></p>
        <a id="cImpA" href="impulse.html"></a>
      </article>

      <article class="card">
        <h2 id="cWorkH"></h2>
        <p id="cWorkP"></p>
        <a id="cWorkA" href="werkstatt.html"></a>
      </article>

      <article class="card">
        <h2 id="cOffersH"></h2>
        <p id="cOffersP"></p>
        <a id="cOffersA" href="angebote.html"></a>
      </article>

      <article class="card">
        <h2 id="cShopH"></h2>
        <p id="cShopP"></p>
        <a id="cShopA" href="shop.html"></a>
      </article>
    </section>

    <footer class="footer">
      <div class="visitor-pill" aria-label="Besucherzähler">
        <span class="label" id="vVisitors"></span>
        <span id="countPage" class="count">—</span>
        <span class="sep">•</span>
        <span class="label" id="vTotal"></span>
        <span id="countTotal" class="count">—</span>
      </div>

      <div class="footer-line">
        © Lampadēphóros • <span id="fContact"></span>
        <a href="mailto:lampadephoros.media@gmail.com">lampadephoros.media@gmail.com</a>
      </div>
    </footer>

  </main>

  <script src="langs.js"></script>
  <script src="start-i18n.js"></script>
  <script src="lang-menu.js"></script>

  <script>
  (function () {
    const qs = new URLSearchParams(location.search);
    const urlLang = (qs.get("lang") || "").toLowerCase();

    const supported = new Set((window.LANGS || []).map(x => x.code));

    const browserPrefs = (navigator.languages && navigator.languages.length)
      ? navigator.languages
      : [navigator.language || "de"];

    const base = (tag) => String(tag || "").toLowerCase().split("-")[0];

    let lang = "de";

    // 1) URL
    if (supported.has(urlLang)) {
      lang = urlLang;
    } else {
      // 2) saved
      const saved = (localStorage.getItem("lamp_lang") || "").toLowerCase();
      if (supported.has(saved)) {
        lang = saved;
      } else {
        // 3) browser
        for (const t of browserPrefs) {
          const b = base(t);
          if (supported.has(b)) { lang = b; break; }
        }
      }
    }

    // persist (wichtig: beide Keys setzen!)
    try { localStorage.setItem("lamp_lang", lang); } catch(e){}
    try { localStorage.setItem("lp_lang",   lang); } catch(e){}

    // document direction
    const curObj = (window.LANGS || []).find(x => x.code === lang);
    const dir = (curObj && curObj.dir) ? curObj.dir : "ltr";
    document.documentElement.setAttribute("dir", dir);
    document.documentElement.setAttribute("lang", lang);

    // set current
    const holder = document.querySelector(".lang[data-current]");
    if (holder) holder.setAttribute("data-current", lang);

    // render menu
    if (typeof window.renderLangMenu === "function") window.renderLangMenu();

    // texts
    const dictAll = window.START_I18N || {};
    const dict = dictAll[lang] || dictAll["de"] || {};

    document.getElementById("heroTitle").textContent = dict.title || "Lampadēphóros";
    document.getElementById("heroSub").textContent = dict.sub || "";
    document.getElementById("noteLine").textContent = dict.note || "";

    const nav = dict.nav || {};
    document.getElementById("navStart").textContent = nav.start || "Start";
    document.getElementById("navAbout").textContent = nav.about || "About";
    document.getElementById("navFilms").textContent = nav.films || "Films";
    document.getElementById("navImpulses").textContent = nav.impulses || "Impulses";
    document.getElementById("navWorkshop").textContent = nav.workshop || "Workshop";
    document.getElementById("navOffers").textContent = nav.offers || "Offers";
    document.getElementById("navShop").textContent = nav.shop || "Shop";
    document.getElementById("navLinks").textContent = nav.links || "Links";

    const c = dict.cards || {};
    const setCard = (key, hId, pId, aId) => {
      document.getElementById(hId).textContent = (c[key] && c[key].h) ? c[key].h : "";
      document.getElementById(pId).textContent = (c[key] && c[key].p) ? c[key].p : "";
      document.getElementById(aId).textContent = (c[key] && c[key].a) ? c[key].a : "";
    };
    setCard("about",    "cAboutH",  "cAboutP",  "cAboutA");
    setCard("films",    "cFilmsH",  "cFilmsP",  "cFilmsA");
    setCard("impulses", "cImpH",    "cImpP",    "cImpA");
    setCard("workshop", "cWorkH",   "cWorkP",   "cWorkA");
    setCard("offers",   "cOffersH", "cOffersP", "cOffersA");
    setCard("shop",     "cShopH",   "cShopP",   "cShopA");

    const f = dict.footer || {};
    document.getElementById("fContact").textContent = f.contact || "Kontakt:";
    document.getElementById("vVisitors").textContent = f.visitors || "Besucher";
    document.getElementById("vTotal").textContent = f.total || "Gesamt";

    // --- helper: internal links keep lang (und Cloudflare-Pages clean routes) ---
    const withLang = (href) => {
      if (!href) return href;

      // don't touch anchors / external / mailto / tel
      if (href.startsWith("#") || href.startsWith("javascript:")) return href;
      if (/^(https?:)?\/\//i.test(href) || href.startsWith("mailto:") || href.startsWith("tel:")) return href;

      const u = new URL(href, location.origin);

      if (!u.searchParams.get("lang")) u.searchParams.set("lang", lang);

      // clean route: /filme statt /filme.html
      u.pathname = u.pathname.replace(/\.html$/i, "");

      return `${u.pathname}?${u.searchParams.toString()}${u.hash || ""}`;
    };

    // set ALL nav hrefs
    document.getElementById("navStart").setAttribute("href", withLang("start.html"));
    document.getElementById("navAbout").setAttribute("href", withLang("about.html"));
    document.getElementById("navFilms").setAttribute("href", withLang("filme.html"));
    document.getElementById("navImpulses").setAttribute("href", withLang("impulse.html"));
    document.getElementById("navWorkshop").setAttribute("href", withLang("werkstatt.html"));
    document.getElementById("navOffers").setAttribute("href", withLang("angebote.html"));
    document.getElementById("navShop").setAttribute("href", withLang("shop.html"));
    document.getElementById("navLinks").setAttribute("href", withLang("links.html"));

    // set ALL card hrefs
    document.getElementById("cAboutA").setAttribute("href", withLang("about.html"));
    document.getElementById("cFilmsA").setAttribute("href", withLang("filme.html"));
    document.getElementById("cImpA").setAttribute("href", withLang("impulse.html"));
    document.getElementById("cWorkA").setAttribute("href", withLang("werkstatt.html"));
    document.getElementById("cOffersA").setAttribute("href", withLang("angebote.html"));
    document.getElementById("cShopA").setAttribute("href", withLang("shop.html"));

    // counter
    (async () => {
      const NS = "lampadephoros_web";
      const PAGE = `start_${lang}`;
      const TOTAL = "start_total";

      const urlPage  = `https://api.counterapi.dev/v1/${NS}/${PAGE}/up`;
      const urlTotal = `https://api.counterapi.dev/v1/${NS}/${TOTAL}/up`;

      const [pageData, totalData] = await Promise.all([
        fetch(urlPage,  { cache: "no-store" }).then(r => r.json()),
        fetch(urlTotal, { cache: "no-store" }).then(r => r.json())
      ]);

      const pick = (obj) => (obj && (obj.count ?? obj.value ?? obj.total ?? obj.result ?? (obj.data && obj.data.count))) ?? "—";
      document.getElementById("countPage").textContent  = pick(pageData);
      document.getElementById("countTotal").textContent = pick(totalData);
    })().catch(() => {
      const a = document.getElementById("countPage");
      const b = document.getElementById("countTotal");
      if (a) a.textContent = "—";
      if (b) b.textContent = "—";
    });
  })();
  </script>
</body>
</html>
